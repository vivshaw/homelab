# Terraform config

[Terraform](https://www.terraform.io/) is used to provision a fleet of virtual machines to the Magi System cluster. Before running Terraform, Packer is used [to build a nice VM template](../packer/README.md). Terraform can then provisions a bunch of machines using that template.

Ultimately, Terraform will also configure these machines into a Nomad cluster with Vault and Consul integration. That doesn't exist yet.

## Running

You'll need to first ensure [the VM images have been generated by Packer](../packer/README.md), then provide Proxmox auth credentials in `credentials.tfvars`. Then:

```shell
terraform init
terraform plan -var-file=credentials.tfvars
terraform apply -var-file=credentials.tfvars
```

If you've already run this, and wish to re-create the templates after some changes, another `terraform apply` may not do the trick- it has a tendency to hang. Try a `terraform destroy` followed by a fresh `terraform apply`. (Would be nice to fix someday!)

## Miscellany

See [`NOTES.md`](./NOTES.md) for miscellaneous notes and learnings I ran across along the way.
